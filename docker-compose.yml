version: '3'
services:
  cloudorchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        CLOUD_VERTION: 5.x-dev
    container_name: cloudorchestrator
    depends_on:
    - mysql
    - memcached
    restart: unless-stopped
    ports:
    - 80:80
    environment:
      DRUPAL_USER: cloud_admin
      DRUPAL_PASSWORD: cloud_admin
      DRUPAL_EMAIL: onotm@intellilink.co.jp
      MYSQL_DATABASE: &MYSQL_DATABASE cloud_orchestrator
      MYSQL_USER: &MYSQL_USER administrator
      MYSQL_PASSWORD: &MYSQL_PASSWORD administrator
    volumes:
    - type: bind
      source: ./volume
      target: /volume

  mysql:
    image: mariadb:10.6-focal
    container_name: mysql
    restart: unless-stopped
    ports:
    - 3306:3306
    environment:
      MYSQL_ROOT_PASSWORD: *MYSQL_PASSWORD
      MYSQL_USER: *MYSQL_USER
      MYSQL_PASSWORD: *MYSQL_PASSWORD
      MYSQL_DATABASE: *MYSQL_DATABASE

  memcached:
    image: memcached:1.6
    container_name: memcached
    restart: unless-stopped
    ports:
    - 11211:11211
